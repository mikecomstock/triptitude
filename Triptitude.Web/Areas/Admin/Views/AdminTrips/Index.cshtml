@{
    IEnumerable<Trip> trips = ViewBag.Trips;
}
<h1>
    Trips</h1>
<h2>
    Not Moderated</h2>
@TripTable(Url, trips.Where(t => !t.ModeratedOnUTC.HasValue).OrderBy(t => t.Id))
<h2>
    Recently Moderated</h2>
@TripTable(Url, trips.Where(t => t.ModeratedOnUTC.HasValue).OrderByDescending(t => t.ModeratedOnUTC))
@helper TripTable(UrlHelper Url, IEnumerable<Trip> trips)
    {
    <table>
        <tr>
            <th>
                Name
            </th>
            <th>
                User(s)
            </th>
            <th>
                Created
            </th>
            <th>
                Activities
            </th>
            <th>
                List Items
            </th>
            <th>
                Show In Search?
            </th>
            <th>
                Moderated
            </th>
        </tr>
        @foreach (Trip trip in trips)
        {
            <tr>
                <td>
                    <a href="@Url.Admin("trips", "details", new { trip.Id })">@trip.Name</a>
                </td>
                <td>
                    @String.Join(", ", trip.UserTrips.Select(ut => ut.User.Id + "|" + ut.User.Email))
                </td>
                <td>
                    @trip.Created_On
                </td>
                <td>
                    @trip.Activities.Count()
                </td>
                <td>
                    @trip.PackingListItems.Count()
                </td>
                <td>
                    @trip.ShowInSearch
                </td>
                <td>
                    @trip.ModeratedOnUTC
                </td>
            </tr>
        }
    </table>   
}