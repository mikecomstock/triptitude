@{
    Trip trip = ViewBag.Trip;
    const string pageName = "Dashboard";
    ViewBag.Title = trip.Name + " - " + pageName;
    User currentUser = ViewBag.CurrentUser;

    ViewBag.ShowInSiteMap = @trip.ShowInSearch;
}
@section Scripts {
    <script type="text/javascript" charset="utf-8">

        (function () {
            var addThis = document.createElement('script'); addThis.type = 'text/javascript'; addThis.async = true;
            addThis.src = 'http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4fa73d1420e93ac7';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(addThis, s);
        })();
        
    </script>
}
@if (currentUser.OwnsTrips(trip))
{
    @Html.Action("SidePanel", "Trips", new { trip })
}
<div class="panel">
    <header>
        @if (trip.Sharable)
        {
@*AddThis Button BEGIN*@
            <div class="share-bar-container">
                <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
                    <a class="addthis_button_facebook"></a><a class="addthis_button_google_plusone_share" title="Send to Google+"></a><a class="addthis_button_twitter"></a><a class="addthis_button_pinterest_share" title="Send to Pinterest"></a>
                </div>
            </div>
@*AddThis Button END*@
        }
        <h1>
            @(currentUser.DefaultTrip == trip ? pageName : ViewBag.Title)
        </h1>
    </header>
    <section id="who">
        <h2>
            Who's Going
            @if (currentUser.CreatedTrips(trip))
            { <span><a href="@Url.Who(trip)">add travelers</a> </span>}
        </h2>
        <ul class="travelers">
            @foreach (UserTrip userTrip in trip.UserTripsFor(currentUser))
            {
                <li><a href="@Url.Details(userTrip.User)">
                    <img src="@userTrip.User.PhotoURLSmall" alt="" />
                    <span>@(userTrip.User == currentUser ? "you" : userTrip.User.NameOrAnon)</span> </a></li>
            }
        </ul>
    </section>
    <section id="itinerary">
        <h2>
            Itinerary
            @if (currentUser.OwnsTrips(trip))
            {
                <span><a href="@Url.Who(trip)" class="super-dialog-link" data-trip-id="@trip.Id">add activities</a> </span>
            }
        </h2>
        <a href="@Url.Itinerary(trip)">@trip.NonDeletedActivities.Count() activities</a>
    </section>
    @if (currentUser.OwnsTrips(trip))
    {
        <section id="packing">
            <h2>
                Packing List <span><a href="@Url.PackingList(trip)">add items</a></span>
            </h2>
            <a href="@Url.PackingList(trip)">@trip.PackingItemSearch(byUser: currentUser, forUser: currentUser).Count() items</a>
        </section>
    }
    @if (currentUser.OwnsTrips(trip))
    {
        <section id="history">
            <h2>
                Recent Changes <span><a href="@Url.History(trip)">view all</a></span>
            </h2>
            <ol class="histories">
                @foreach (var history in trip.Histories.OrderByDescending(h => h.Id).Take(6))
                {
                    <li>
                        @history.ToString(currentUser)
                    </li>
                }
            </ol>
        </section>
    }
</div>
