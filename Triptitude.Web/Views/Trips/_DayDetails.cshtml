@{
    Trip trip = (Trip)ViewBag.Trip;
}
<div class="trip-day">
    <h3>
        @trip.NiceDay(ViewBag.DayNumber, ViewBag.CurrentUser)
    </h3>
    @foreach (Activity activity in trip.ActivitiesOn(ViewBag.DayNumber))
    {
        <div class="activity" data-activity-id="@activity.Id" data-activity-type="@activity.ActivityTypeName" title="Click for details">
            @if (ViewBag.CurrentUserOwnsTrip && activity.Notes.Any())
            {   
                <div class="notes">@activity.Notes.Count() notes</div>
            }
            @if (activity is TransportationActivity)
            {
                var transportationActivity = activity as TransportationActivity;
                <div class="title">
                    @transportationActivity.TransportationType.Name
                    @if (transportationActivity.FromPlace != null)
                    {
                        <text>from <a href="@Url.Details(transportationActivity.FromPlace)">@transportationActivity.FromPlace.Name</a></text>
                    }
                    @if (transportationActivity.ToPlace != null)
                    {
                        <text>to <a href="@Url.Details(transportationActivity.ToPlace)">@transportationActivity.ToPlace.Name</a></text>
                    }
                </div>
            }
            else if (activity is HotelActivity)
            {
                var hotelActivity = activity as HotelActivity;
                if (ViewBag.DayNumber == hotelActivity.BeginDay)
                {
                <img src="@hotelActivity.Hotel.Photo.ThumbURL" alt="" />
                }
                <div class="title">
                    @if (ViewBag.DayNumber == hotelActivity.BeginDay)
                    {
                        <p>
                            Check in to <a href="@Url.Details(hotelActivity.Hotel)">@hotelActivity.Hotel.Name</a> for a @(hotelActivity.EndDay - hotelActivity.BeginDay)
                            night stay
                        </p>
                    }
                    else
                    {
                        <p>
                            Check out of <a href="@Url.Details(hotelActivity.Hotel)">@hotelActivity.Hotel.Name</a>
                        </p>
                    }
                </div>
            }
            else if (activity is PlaceActivity)
            {
                var placeActivity = activity as PlaceActivity;

                if (!string.IsNullOrWhiteSpace(placeActivity.Title))
                {
                <div class="title">
                    @placeActivity.Title
                </div>
                }

                if (placeActivity.Place != null)
                {
                <div class="place @(string.IsNullOrWhiteSpace(placeActivity.Title) ? "no-title" : "with-title")">
                    <a href="@Url.Details(placeActivity.Place)">@placeActivity.Place.Name</a>
                </div>
                }
            }
            @Helpers.TagList(Url, activity.Tags)
        </div>
    }
</div>
